#!/bin/sh

ksym() {
    cat /proc/kallsyms | grep " $1"'$' | awk '{ print $1 }'
}

echo insmod khax.ko \
    aml_blob_encdec=0xffffff8002753340 \
    kmalloc=0x$(ksym __kmalloc) \
    kfree=0x$(ksym kfree) \
    flush_dcache_area=0x$(ksym __flush_dcache_area)

insmod khax.ko \
    aml_blob_encdec=0xffffff8002753340 \
    kmalloc=0x$(ksym __kmalloc) \
    kfree=0x$(ksym kfree) \
    flush_dcache_area=0x$(ksym __flush_dcache_area) \

echo "[+] LKM loaded"
